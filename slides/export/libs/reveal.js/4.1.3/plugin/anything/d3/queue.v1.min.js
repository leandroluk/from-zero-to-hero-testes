!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define("queue",r):n.queue=r()}(this,function(){"use strict";function n(){}function r(r){function t(){if(!h)try{l()}catch(n){s[v+y-1]&&i(n)}}function l(){for(;h=d&&r>y;){var n=v+y,t=s[n],u=t.length-1,o=t[u];t[u]=f(n),--d,++y,t=o.apply(null,t),s[n]&&(s[n]=t||e)}}function f(n){return function(r,u){s[n]&&(--y,++v,s[n]=null,null==p&&(null!=r?i(r):(w[n]=u,d?t():y||c())))}}function i(n){var r,t=s.length;for(p=n,w=null,d=NaN;--t>=0;)if((r=s[t])&&(s[t]=null,r.abort))try{r.abort()}catch(n){}y=NaN,c()}function c(){null!=p?b(p):g?b(null,w):b.apply(null,o.concat(w))}if(!(r>=1))throw new Error;var a,h,p,s=[],w=[],d=0,y=0,v=0,b=n,g=!0;return a={defer:function(r){if(b!==n)throw new Error;if(null!=p)return a;var e=u.call(arguments,1);return e.push(r),++d,s.push(e),t(),a},abort:function(){return null==p&&i(new Error("abort")),a},await:function(r){if(b!==n)throw new Error;return b=r,g=!1,y||c(),a},awaitAll:function(r){if(b!==n)throw new Error;return b=r,g=!0,y||c(),a}}}function t(n){return r(arguments.length?+n:1/0)}var u=[].slice,e={},o=[null];return t.version="1.2.1",t});